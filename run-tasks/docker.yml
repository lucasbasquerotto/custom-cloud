### Ensure docker is running and update the docker-compose executable ###

- name: "{{ params.title }} - params"
  set_fact:
    task_params: "{{ tmp_params }}"
    compose_params: "{{ tmp_params.compose | default({}) }}"
  vars:
    tmp_params: "{{ task_params }}"
  tags: ["no_print"]

- name: "{{ params.title }} - copy the docker compose executable file"
  become: "{{ params.task.root | default(false) }}"
  get_url:
    url: "{{ compose_params.src | default(tmp_default_url) }}"
    dest: "{{ compose_params.dest | default('/usr/local/bin/docker-compose') }}"
    mode: "{{ compose_params.mode | default(0755) }}"
  vars:
    tmp_default_url: >-
      https://github.com/docker/compose/releases/download/{{
        compose_params.version | default('')
      }}/docker-compose-Linux-x86_64
  when: >-
    ((compose_params.src | default('')) != '')
    or
    ((compose_params.version | default('')) != '')
  tags: ["no_print_skipped"]

- name: "{{ params.title }} - ensure docker is running"
  become: "{{ params.task.root | default(false) }}"
  service:
    name: docker
    state: started
  when: task_params.start_service | default(false) | bool
  tags: ["no_print_skipped"]
